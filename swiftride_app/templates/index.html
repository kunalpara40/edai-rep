<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SwiftRide - Premium Cab Services</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-polyline-encoded@0.0.4/Polyline.encoded.js"></script>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@mapbox/polyline"></script>
  <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</head>
<style>
.ride-status-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

.status-header {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 30px;
}

.back-btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  transition: all 0.3s;
}

.back-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: translateX(-5px);
}

.status-card {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 30px;
  margin-bottom: 30px;
}

.status-info {
  text-align: center;
  margin-bottom: 30px;
}

.status-badge {
  display: inline-block;
  padding: 12px 24px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 1.1rem;
  margin-bottom: 15px;
  animation: pulse 2s infinite;
}

.status-badge.waiting {
  background: #ffc107;
  color: #000;
}

.status-badge.accepted {
  background: #10b981;
  color: white;
}

.status-badge.in-progress {
  background: #3b82f6;
  color: white;
}

.status-badge.completed {
  background: #10b981;
  color: white;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.driver-info-card {
  display: flex;
  align-items: center;
  gap: 20px;
  background: rgba(16, 185, 129, 0.1);
  padding: 20px;
  border-radius: 12px;
  margin-bottom: 30px;
  border: 2px solid #10b981;
}

.driver-avatar-large {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  background: linear-gradient(135deg, #10b981, #0ea572);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: white;
}

.driver-details-large h3 {
  margin: 0 0 8px 0;
  font-size: 1.4rem;
}

.driver-rating {
  color: #ffc107;
  font-size: 1.1rem;
  margin-bottom: 8px;
}

.driver-details-large p {
  margin: 5px 0;
  color: #aaa;
}

.trip-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.trip-detail-item {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 15px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.trip-detail-item i {
  font-size: 1.5rem;
  margin-top: 5px;
}

.trip-detail-item small {
  display: block;
  color: #888;
  font-size: 0.85rem;
  margin-bottom: 5px;
}

.trip-detail-item p {
  margin: 0;
  font-weight: 600;
  font-size: 1rem;
}

.payment-section {
  background: rgba(255, 255, 255, 0.05);
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 30px;
}

.payment-section h3 {
  margin: 0 0 20px 0;
  font-size: 1.2rem;
}

.payment-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.payment-option {
  cursor: pointer;
}

.payment-option input[type="radio"] {
  display: none;
}

.payment-card {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 20px;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid transparent;
  border-radius: 10px;
  transition: all 0.3s;
}

.payment-option input[type="radio"]:checked + .payment-card {
  border-color: #10b981;
  background: rgba(16, 185, 129, 0.1);
}

.payment-card:hover {
  background: rgba(255, 255, 255, 0.1);
}

.payment-card i {
  font-size: 2rem;
  color: #10b981;
}

.payment-card strong {
  display: block;
  margin-bottom: 5px;
}

.payment-card small {
  color: #888;
  font-size: 0.85rem;
}

.ride-actions {
  display: flex;
  gap: 15px;
  justify-content: center;
}

.status-map-container {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 25px;
}

.status-map-container h3 {
  margin: 0 0 20px 0;
  font-size: 1.3rem;
}

@media (max-width: 768px) {
  .driver-info-card {
    flex-direction: column;
    text-align: center;
  }

  .trip-details {
    grid-template-columns: 1fr;
  }

  .ride-actions {
    flex-direction: column;
  }

  .ride-actions button {
    width: 100%;
  }
}



.wallet-display {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(14, 165, 114, 0.2));
  border: 2px solid #10b981;
  border-radius: 20px;
  color: #10b981;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s;
  cursor: pointer;
}

.wallet-display:hover {
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(14, 165, 114, 0.3));
  transform: translateY(-2px);
}

.wallet-display i {
  font-size: 1.1rem;
}

#navbar-wallet-balance {
  font-weight: bold;
  letter-spacing: 0.5px;
}

/* Dropdown menu improvements */
.dropdown-menu a {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 15px;
  color: white;
  text-decoration: none;
  transition: all 0.3s;
}

.dropdown-menu a:hover {
  background: rgba(95, 227, 46, 0.1);
  padding-left: 20px;
}

.dropdown-menu a i {
  width: 20px;
  text-align: center;
}

.dropdown-menu hr {
  border: none;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  margin: 10px 0;
}
</style>
<body>
  <!-- Animated background elements -->
  <div class="bg-elements">
    <div style="left: 10%; animation-delay: 0s;"></div>
    <div style="left: 20%; animation-delay: 2s;"></div>
    <div style="left: 30%; animation-delay: 4s;"></div>
    <div style="left: 40%; animation-delay: 6s;"></div>
    <div style="left: 50%; animation-delay: 8s;"></div>
    <div style="left: 60%; animation-delay: 10s;"></div>
    <div style="left: 70%; animation-delay: 12s;"></div>
    <div style="left: 80%; animation-delay: 14s;"></div>
    <div style="left: 90%; animation-delay: 16s;"></div>
  </div>

  <!-- Navigation -->
 <nav class="navbar">
    <a href="#" class="nav-logo" onclick="showPage('home')">SwiftRide</a>
    
    <div class="nav-links" id="nav-links">
      <a href="#" class="nav-link active" onclick="showPage('home')">Home</a>
      <a href="#" class="nav-link" onclick="showPage('ride')">Ride</a>

      {% if session.get('user_id') %}
        <!-- User is logged in - Show wallet balance -->
        <div class="wallet-display" id="user-wallet-display">
          <i class="fas fa-wallet"></i>
          <span id="navbar-wallet-balance">‚Çπ2000</span>
        </div>

        <!-- User dropdown -->
        <div class="user-dropdown">
          <button class="user-btn" id="userBtn">
            {{ session.get('firstName') or 'User' }}
            <span class="arrow">‚ñº</span>
          </button>
          <div class="dropdown-menu" id="dropdownMenu">
            <div class="user-info">
              <strong>{{ session.get('firstName') or 'User' }}</strong><br>
              <small>{{ session.get('email') or '' }}</small>
              <img src="{{ url_for('static', filename='images/profile.png') }}" alt="Profile" width="30">
            </div>
            <hr>
            <a href="#" onclick="showWalletDetails()">
              <i class="fas fa-wallet"></i> My Wallet
            </a>
            <a href="#">
              <i class="fas fa-history"></i> Ride History
            </a>
            <a href="#" onclick="showPage('ride')">
              <i class="fas fa-car"></i> Book Ride
            </a>
            <hr>
            <a href="#" id="logout-btn">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </div>
        </div>
      {% else %}
        <!-- Not logged in -->
        <a href="#" class="nav-link" onclick="showPage('signup')">Users</a>
        <a href="#" class="nav-link" onclick="showPage('driver-signup')">Driver's</a>
      {% endif %}

      <button class="theme-toggle" onclick="toggleTheme()">üí°</button>
    </div>
  </nav>


  <!-- Home Page -->
  <div id="home-page" class="page-container active">
    <div class="hero-section">
      <h2>Premium Cab Service</h2>
      {% if session.get('user_id') %}
      <h3>Get ready for Your first Trip!</h3>
      {% endif %}
      
      <!-- <div class="ride-section-container">
        <section class="ride-booking">
          {% if not session.get('user_id') %}
          <h2>Book Your Ride</h2>
          <p>Enter your pickup and drop-off locations to get an instant fare estimate.</p>
          {% endif %}
          {% if session.get('user_id') %}
          <p>Discover the convenience of SwiftRide. Request a ride now, or schedule one for later directly from your browser.</p>
          {% endif %}

          <div class="ride-form">
          
            <div class="location-input">
              <span class="icon pickup-icon"></span>
              <input type="text" id="pickup" placeholder="Pickup location">
              <i class="fas fa-location-arrow map-icon"></i>
            </div>

            <div class="connector"></div>

           
            <div class="location-input">
              <span class="icon dropoff-icon"></span>
              <input type="text" id="dropoff" placeholder="Dropoff location">
            </div>

            <button onclick="showPrice()">See prices</button>
          </div>
          <p id="price-output"></p>
        </section>
        <div id="map-container" style="width:100%; height:400px;"></div>
      </div> -->
      <!-- HOME PAGE RIDE SECTION -->
<div class="ride-section-container">
  <section class="ride-booking">
    {% if not session.get('user_id') %}
    <h2>Book Your Ride</h2>
    <p>Enter your pickup and drop-off locations to get an instant fare estimate.</p>
    {% endif %}
    {% if session.get('user_id') %}
    <p>Discover the convenience of SwiftRide. Request a ride now, or schedule one for later directly from your browser.</p>
    {% endif %}

    <div class="ride-form">
      <!-- Pickup with GPS icon -->
      <div class="location-input">
        <span class="icon pickup-icon"></span>
        <input type="text" id="pickup" placeholder="Pickup location">
        <i class="fas fa-location-arrow map-icon" 
           style="cursor: pointer; color: #10b981; font-size: 1.2rem;" 
           title="Use my current location"
           onclick="useCurrentLocationAsPickup('pickup', 'map-container')"></i>
      </div>

      <!-- Connector line -->
      <div class="connector"></div>

      <!-- Dropoff -->
      <div class="location-input">
        <span class="icon dropoff-icon"></span>
        <input type="text" id="dropoff" placeholder="Dropoff location">
      </div>

      <button onclick="showPrice()">See prices</button>
    </div>
    <p id="price-output"></p>
  </section>
  <div id="map-container" style="width:100%; height:400px;"></div>
</div>

      <section class="steps-section">
        <h2>Book your trip on your computer</h2>

        <div class="step">
          <div class="video">
            <video width="500" autoplay loop muted>
              <source src="{{ url_for('static', filename='videos/demo.mp4') }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          <div class="text">
            <h3>1. Add your trip details</h3>
            <p>Enter your pickup spot and destination, and check prices for your trip.</p>
          </div>
        </div>

        <div class="step">
          <div class="video">
            <video width="500" autoplay loop muted>
              <source src="{{ url_for('static', filename='videos/demo2.mp4') }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
          <div class="text">
            <h3>2. Pay easily</h3>
            <p>Add your preferred payment method, then choose among the ride options available in your location.</p>
          </div>
        </div>
      </section>

      {% if not session.get('user_id') %}
        <div class="hero-buttons">
          <button class="btn btn-primary" onclick="showPage('signup')">
            <i class="fas fa-user-plus"></i> Create Account
          </button>
          <button class="btn btn-outline" onclick="showPage('login')">
            <i class="fas fa-sign-in-alt"></i> Sign In
          </button>
        </div>
      {% endif %}

      <div class="features-section">
        {% if not session.get('user_id') %}
        <div class="feature-card" onclick="showPage('login')">
          <i class="fas fa-bolt"></i>
          <h3>Quick Booking</h3>
          <p>Get a ride in just a few taps</p>
        </div>
        {% endif %}
        <div class="feature-card">
          <i class="fas fa-shield-alt"></i>
          <h3>Safe Travel</h3>
          <p>Verified drivers and vehicles</p>
        </div>
        <div class="feature-card">
          <i class="fas fa-map-marker-alt"></i>
          <h3>Live Tracking</h3>
          <p>Real-time ride tracking</p>
        </div>
        <div class="feature-card">
          <i class="fas fa-money-bill-wave"></i>
          <h3>Best Prices</h3>
          <p>Affordable rates for everyone</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Ride Page -->
  <!-- <div id="ride-page" class="page-container">
    <div class="ride-container">
      <div class="ride-form">
      
        <div class="location-input">
          <span class="icon pickup-icon"></span>
          <input type="text" id="ride-pickup" placeholder="Pickup location">
          <i class="fas fa-location-arrow map-icon"></i>
        </div>

     
        <div class="ride-line"></div>

      
        <div class="location-input">
          <span class="icon dropoff-icon"></span>
          <input type="text" id="ride-dropoff" placeholder="Dropoff location">
        </div>

        <button onclick="showPrice()">Check Price</button>
        <p id="ride-price-output"></p>
      </div>
    </div>
    <div id="ride-map-container" style="width:100%; height:400px;"></div>
  </div> -->
  <!-- RIDE PAGE SECTION -->
<div id="ride-page" class="page-container">
  <div class="ride-container">
    <div class="ride-form">
      <!-- Pickup with GPS icon -->
      <div class="location-input">
        <span class="icon pickup-icon"></span>
        <input type="text" id="ride-pickup" placeholder="Pickup location">
        <i class="fas fa-location-arrow map-icon" 
           style="cursor: pointer; color: #10b981; font-size: 1.2rem;" 
           title="Use my current location"
           onclick="useCurrentLocationAsPickup('ride-pickup', 'ride-map-container')"></i>
      </div>

      <!-- Line -->
      <div class="ride-line"></div>

      <!-- Dropoff -->
      <div class="location-input">
        <span class="icon dropoff-icon"></span>
        <input type="text" id="ride-dropoff" placeholder="Dropoff location">
      </div>

      <button onclick="showPrice()">Check Price</button>
      <p id="ride-price-output"></p>
    </div>
  </div>
  <div id="ride-map-container" style="width:100%; height:400px;"></div>
</div>

  <!-- Login Page -->
  <div id="login-page" class="page-container">
    <div class="main-container">
      <!-- Brand/Info Section -->
      <div class="brand-section">
        <div class="logo">SwiftRide</div>
        <div class="brand-content">
          <h2>Welcome Back!</h2>
          <p>Sign in to access your account and book your next ride</p>

          <ul class="features">
            <li><i class="fas fa-check-circle"></i> Quick and easy access</li>
            <li><i class="fas fa-check-circle"></i> Manage your rides</li>
            <li><i class="fas fa-check-circle"></i> Update payment methods</li>
            <li><i class="fas fa-check-circle"></i> View ride history</li>
            <li><i class="fas fa-check-circle"></i> Exclusive member benefits</li>
          </ul>
        </div>
      </div>

      <!-- Login Form Section -->
      <div class="form-section">
        <div class="form-header">
          <h1>Sign In to Your Account</h1>
          <p>Enter your credentials to continue</p>
        </div>

        <form id="login-form">
          <div class="input-group">
            <label for="login-email">Email Address</label>
            <div class="input-field">
              <i class="fas fa-envelope"></i>
              <input type="email" id="login-email" placeholder="Enter your email address" required>
            </div>
          </div>

          <div class="input-group">
            <label for="login-password">Password</label>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input type="password" id="login-password" placeholder="Enter your password" required>
              <span class="toggle-password" onclick="togglePassword('login-password', this)">üëÅÔ∏è</span>
            </div>
          </div>

          <div class="login-options">
            <div class="remember-me">
              <input type="checkbox" id="remember">
              <label for="remember">Remember me</label>
            </div>
            <a href="#" class="forgot-password">Forgot password?</a>
          </div>

          <div class="btn-group">
            <button type="submit" class="btn btn-primary">Sign In</button>
          </div>

          <div class="social-login">
            <p>Or sign in with</p>
            <div class="social-buttons">
              <div class="social-btn google">
                <i class="fab fa-google"></i>
              </div>
              <div class="social-btn facebook">
                <i class="fab fa-facebook-f"></i>
              </div>
              <div class="social-btn apple">
                <i class="fab fa-apple"></i>
              </div>
            </div>
          </div>

          <div class="form-link">
            Don't have an account? <a href="#" onclick="showPage('signup')">Sign up</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Signup Page -->
  <div id="signup-page" class="page-container">
    <div class="main-container">
      <!-- Brand/Info Section -->
      <div class="brand-section">
        <div class="logo">SwiftRide</div>
        <div class="brand-content">
          <h2>Join Thousands of Riders</h2>
          <p>Create your account and enjoy premium cab services</p>

          <ul class="features">
            <li><i class="fas fa-check-circle"></i> Quick and easy registration</li>
            <li><i class="fas fa-check-circle"></i> Exclusive member discounts</li>
            <li><i class="fas fa-check-circle"></i> Ride history tracking</li>
            <li><i class="fas fa-check-circle"></i> Priority customer support</li>
            <li><i class="fas fa-check-circle"></i> Personalized travel experience</li>
          </ul>
        </div>
      </div>

      <!-- Signup Form Section -->
      <div class="form-section">
        <div class="form-header">
          <h1>Create Your Account</h1>
          <p>Join us today and experience premium cab services</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-bar">
          <div class="progress-step active">1</div>
          <div class="progress-step">2</div>
          <div class="progress-step">3</div>
        </div>

        <!-- Step 1: Personal Information -->
        <form class="form-step active" id="step1">
          <div class="input-row">
            <div class="input-group">
              <label for="firstName">First Name</label>
              <div class="input-field">
                <i class="fas fa-user"></i>
                <input type="text" id="firstName" placeholder="Enter your first name" required>
              </div>
            </div>
            <div class="input-group">
              <label for="lastName">Last Name</label>
              <div class="input-field">
                <i class="fas fa-user"></i>
                <input type="text" id="lastName" placeholder="Enter your last name" required>
              </div>
            </div>
          </div>

          <div class="input-group">
            <label for="email">Email Address</label>
            <div class="input-field">
              <i class="fas fa-envelope"></i>
              <input type="email" id="email" placeholder="Enter your email address" required>
            </div>
          </div>

          <div class="input-group">
            <label for="phone">Phone Number</label>
            <div class="input-field">
              <i class="fas fa-phone"></i>
              <input type="tel" id="phone" placeholder="Enter 10-digit phone number" maxlength="10" required>
            </div>
            <small id="phoneError" style="display:none; color:red;">Phone number must be 10 digits only</small>
          </div>

          <div class="btn-group">
            <button type="button" class="btn btn-primary" onclick="nextStep(1)">Next</button>
          </div>
        </form>

        <!-- Step 2: Account Details -->
        <form class="form-step" id="step2">
          <div class="input-group">
            <label for="password">Password</label>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input type="password" id="password" placeholder="Create a strong password" required>
              <span class="toggle-password" onclick="togglePassword('password', this)">üëÅÔ∏è</span>
            </div>
            <div class="password-strength">
              <div class="strength-meter" id="passwordStrength"></div>
            </div>
            <small id="passwordHelp" style="display:block; margin-top:5px; color:var(--gray);">
              Use at least 8 characters with a mix of letters, numbers & symbols
            </small>
          </div>

          <div class="input-group">
            <label for="confirmPassword">Confirm Password</label>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input type="password" id="confirmPassword" placeholder="Confirm your password" required>
              <span class="toggle-password" onclick="togglePassword('confirmPassword', this)">üëÅÔ∏è</span>
            </div>
            <small id="passwordMatch" style="display:none; margin-top:5px; color:red;">
              Passwords do not match
            </small>
          </div>

          <div class="btn-group">
            <button type="button" class="btn btn-outline" onclick="showStep(1)">Back</button>
            <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next</button>
          </div>
        </form>

        <!-- Step 3: Additional Information -->
        <form class="form-step" id="step3">
          <div class="input-group">
            <label for="address">Home Address</label>
            <div class="input-field">
              <i class="fas fa-home"></i>
              <input type="text" id="address" placeholder="Enter your home address">
            </div>
          </div>

          <div class="input-group">
            <label for="state">State</label>
            <div class="input-field">
              <i class="fas fa-map-marker-alt"></i>
              <select id="state">
                <option value="">Select your state</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Delhi">Delhi</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="West Bengal">West Bengal</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Uttar Pradesh">Uttar Pradesh</option>
              </select>
            </div>
          </div>

          <div class="input-row">
            <div class="input-group">
              <label for="city">City</label>
              <div class="input-field">
                <i class="fas fa-city"></i>
                <select id="city">
                  <option value="">Select your city</option>
                </select>
              </div>
            </div>
            <div class="input-group">
              <label for="zipCode">ZIP Code</label>
              <div class="input-field">
                <i class="fas fa-mail-bulk"></i>
                <input type="text" id="zipCode" placeholder="ZIP code">
              </div>
            </div>
          </div>

          <div class="input-group">
            <label for="preferredPayment">Preferred Payment Method</label>
            <div class="input-field">
              <i class="fas fa-credit-card"></i>
              <select id="preferredPayment">
                <option value="">Select payment method</option>
                <option value="credit_card">Credit Card</option>
                <option value="debit_card">Debit Card</option>
                <option value="paypal">PayPal</option>
                <option value="upi">UPI</option>
                <option value="cash">Cash</option>
              </select>
            </div>
          </div>

          <div class="terms">
            <input type="checkbox" id="terms" required>
            <label for="terms">I agree to the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></label>
          </div>

          <div class="terms">
            <input type="checkbox" id="newsletter">
            <label for="newsletter">Send me promotional offers and updates</label>
          </div>

          <div class="btn-group">
            <button type="button" class="btn btn-outline" onclick="showStep(2)">Back</button>
            <button type="submit" class="btn btn-primary">Create Account</button>
          </div>
        </form>

        <div class="form-link">
          Already have an account? <a href="#" onclick="showPage('login')">Log in</a>
        </div>
      </div>
    </div>
  </div>

 <!-- DRIVER SIGNUP PAGE -->
<!-- Replace your driver-signup-page section with this -->
<div id="driver-signup-page" class="page-container">
  <div class="main-container">
   
    <div class="brand-section">
      <div class="logo">SwiftRide</div>
      <div class="brand-content">
        <h2>Driver Sign Up</h2>
        <p>Join SwiftRide and start earning by providing quality rides!</p>
        <ul class="features">
          <li><i class="fas fa-check-circle"></i> Quick onboarding</li>
          <li><i class="fas fa-check-circle"></i> Upload license & documents</li>
          <li><i class="fas fa-check-circle"></i> Start earning today</li>
        </ul>
      </div>
    </div>

    <div class="form-section">
      <div class="form-header">
        <h1>Create Your Driver Account</h1>
        <p>Fill out the details below to get started</p>
      </div>

     
      <div class="progress-bar">
        <div class="progress-step active">1</div>
        <div class="progress-step">2</div>
        <div class="progress-step">3</div>
      </div>

      
      <div class="form-step active" id="driverStep1">
        <div class="input-row">
          <div class="input-group">
            <label for="driver_firstName">First Name</label>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" id="driver_firstName" placeholder="Enter your first name" required>
            </div>
          </div>
          <div class="input-group">
            <label for="driver_lastName">Last Name</label>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input type="text" id="driver_lastName" placeholder="Enter your last name" required>
            </div>
          </div>
        </div>

        <div class="input-group">
          <label for="driver_email">Email Address</label>
          <div class="input-field">
            <i class="fas fa-envelope"></i>
            <input type="email" id="driver_email" placeholder="Enter your email address" required>
          </div>
        </div>

        <div class="input-group">
          <label for="driver_phone">Phone Number</label>
          <div class="input-field">
            <i class="fas fa-phone"></i>
            <input type="tel" id="driver_phone" placeholder="Enter 10-digit phone number" maxlength="10" required>
          </div>
          <small id="driver_phoneError" style="display:none; color:red;">Phone number must be 10 digits only</small>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" onclick="nextStep(1)">Next</button>
           <!-- <a href="#" class="" onclick="showPage('driver-login')">Driver Login</a> -->
        </div>
          <div class="form-link">
          Already have an account? <a href="#" onclick="showPage('driver-login')">Log in</a>
        </div>
      </div>

      
      <div class="form-step" id="driverStep2">
        <div class="input-group">
          <label for="license_no">License Number</label>
          <div class="input-field">
            <i class="fas fa-id-card"></i>
            <input type="text" id="license_no" placeholder="Enter license number" required>
          </div>
        </div>

        <div class="input-group">
          <label for="license_image">Upload License Image</label>
          <div class="input-field">
            <i class="fas fa-file-upload"></i>
            <input type="file" id="license_image" accept=".jpg,.jpeg,.png,.pdf" required>
          </div>
          <div class="file-preview" id="licensePreview" style="margin-top:8px;"></div>
        </div>

        <div class="input-group">
          <label for="vehicle_type">Vehicle Type</label>
          <div class="input-field">
            <i class="fas fa-car"></i>
            <select id="vehicle_type" required>
              <option value="">Select your vehicle type</option>
              <option value="Sedan">Sedan</option>
              <option value="Hatchback">Hatchback</option>
              <option value="SUV">SUV</option>
              <option value="Auto Rickshaw">Auto Rickshaw</option>
            </select>
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label for="vehicle_make">Vehicle Make</label>
            <div class="input-field">
              <i class="fas fa-car-side"></i>
              <input type="text" id="vehicle_make" placeholder="e.g., Toyota, Honda">
            </div>
          </div>
          <div class="input-group">
            <label for="vehicle_model">Vehicle Model</label>
            <div class="input-field">
              <i class="fas fa-car"></i>
              <input type="text" id="vehicle_model" placeholder="e.g., Camry, City">
            </div>
          </div>
        </div>

        <div class="input-group">
          <label for="license_plate">License Plate Number</label>
          <div class="input-field">
            <i class="fas fa-id-badge"></i>
            <input type="text" id="license_plate" placeholder="Enter vehicle registration number" style="text-transform: uppercase;">
          </div>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-outline" onclick="showStep(1)">Back</button>
          <button type="button" class="btn btn-primary" onclick="nextStep(2)">Next</button>
        </div>
      </div>

     
<form class="form-step" id="driverStep3">
  <div class="input-group">
    <label for="password_driver">Password</label>
    <div class="input-field">
      <i class="fas fa-lock"></i>
      <input type="password" id="password_driver" placeholder="Create a strong password" required minlength="8">
      <span class="toggle-password" onclick="togglePassword('password_driver', this)">üëÅÔ∏è</span>
    </div>
    <div class="password-strength">
      <div class="strength-meter" id="passwordStrength"></div>
    </div>
    <small style="display:block; margin-top:5px; color:var(--gray);">
      Use at least 8 characters with a mix of letters, numbers & symbols
    </small>
  </div>

  <div class="input-group">
    <label for="confirmPassword_driver">Confirm Password</label>
    <div class="input-field">
      <i class="fas fa-lock"></i>
      <input type="password" id="confirmPassword_driver" placeholder="Confirm password" required>
      <span class="toggle-password" onclick="togglePassword('confirmPassword_driver', this)">üëÅÔ∏è</span>
    </div>
    <small id="driver_passwordMatch" style="display:none; color:red;">Passwords do not match</small>
  </div>

  <div class="terms">
    <input type="checkbox" id="terms_driver" required>
    <label for="terms_driver">I agree to the <a href="#">Terms of Service</a> & <a href="#">Privacy Policy</a></label>
  </div>

  <div class="btn-group">
    <button type="button" class="btn btn-outline" onclick="showStep(2)">Back</button>
    <button type="submit" class="btn btn-primary">Create Driver Account</button>
  </div>
    
</form>
 </div> <!-- End form-section -->
  </div> <!-- End main-container -->
</div> 

 


<!-- DRIVER LOGIN PAGE - Place this in your index.html -->
<!-- Replace the entire driver-login-page section with this -->

<div id="driver-login-page" class="page-container">
  <div class="main-container">
    <!-- Brand/Info Section -->
    <div class="brand-section">
      <div class="logo">SwiftRide</div>
      <div class="brand-content">
        <h2>Driver Login</h2>
        <p>Sign in to access your driver dashboard and manage your rides</p>

        <ul class="features">
          <li><i class="fas fa-check-circle"></i> View ride requests</li>
          <li><i class="fas fa-check-circle"></i> Manage your schedule</li>
          <li><i class="fas fa-check-circle"></i> Track earnings</li>
          <li><i class="fas fa-check-circle"></i> Update availability</li>
          <li><i class="fas fa-check-circle"></i> View ratings and feedback</li>
        </ul>
      </div>
    </div>

    <!-- Login Form Section -->
    <div class="form-section">
      <div class="form-header">
        <h1>Driver Sign In</h1>
        <p>Enter your credentials to access your dashboard</p>
      </div>

      <form id="driver-login-form">
        <div class="input-group">
          <label for="driver-login-email">Email Address</label>
          <div class="input-field">
            <i class="fas fa-envelope"></i>
            <input type="email" id="driver-login-email" placeholder="Enter your email address">
          </div>
        </div>
        
        <div class="input-group">
          <label for="driver-login-phone">Phone Number (Optional)</label>
          <div class="input-field">
            <i class="fas fa-phone"></i>
            <input type="tel" id="driver-login-phone" placeholder="Or enter your phone number" maxlength="10">
          </div>
          <small style="color: var(--gray); display: block; margin-top: 5px;">
            You can login with either email or phone
          </small>
        </div>

        <div class="input-group">
          <label for="driver-login-password">Password</label>
          <div class="input-field">
            <i class="fas fa-lock"></i>
            <input type="password" id="driver-login-password" placeholder="Enter your password" required>
            <span class="toggle-password" onclick="togglePassword('driver-login-password', this)">üëÅÔ∏è</span>
          </div>
        </div>

        <div class="login-options">
          <div class="remember-me">
            <input type="checkbox" id="driver-remember">
            <label for="driver-remember">Remember me</label>
          </div>
          <a href="#" class="forgot-password">Forgot password?</a>
        </div>

        <div class="btn-group">
          <button type="submit" class="btn btn-primary">Sign In as Driver</button>
        </div>

        <div class="social-login">
          <p>Or sign in with</p>
          <div class="social-buttons">
            <div class="social-btn google">
              <i class="fab fa-google"></i>
            </div>
            <div class="social-btn facebook">
              <i class="fab fa-facebook-f"></i>
            </div>
            <div class="social-btn apple">
              <i class="fab fa-apple"></i>
            </div>
          </div>
        </div>

        <div class="form-link">
          Not a driver yet? <a href="#" onclick="showPage('driver-signup')">Sign up as driver</a> | 
          <a href="#" onclick="showPage('login')">User login</a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add this new page section to your index.html -->

<!-- Ride Status Page (for users to track their ride) -->
<div id="ride-status-page" class="page-container">
  <div class="ride-status-container">
    <div class="status-header">
      <button class="back-btn" onclick="showPage('home')">
        <i class="fas fa-arrow-left"></i> Back
      </button>
      <h2>Your Ride Status</h2>
    </div>

    <!-- Ride Status Card -->
    <div class="status-card" id="status-card">
      <div class="status-info">
        <div class="status-badge" id="ride-status-badge">
          <i class="fas fa-spinner fa-spin"></i> Waiting for driver...
        </div>
        <p id="status-message">Finding a driver for you...</p>
      </div>

      <!-- Driver Info (shown when accepted) -->
      <div class="driver-info-card" id="driver-info-card" style="display: none;">
        <div class="driver-avatar-large">
          <i class="fas fa-user"></i>
        </div>
        <div class="driver-details-large">
          <h3 id="driver-name-display">Driver Name</h3>
          <div class="driver-rating">
            <i class="fas fa-star"></i>
            <span id="driver-rating-display">5.0</span>
          </div>
          <p id="driver-vehicle-display">Vehicle Type - Plate Number</p>
          <p id="driver-phone-display"><i class="fas fa-phone"></i> Phone Number</p>
        </div>
      </div>

      <!-- Trip Details -->
      <div class="trip-details">
        <div class="trip-detail-item">
          <i class="fas fa-map-marker-alt" style="color: #10b981;"></i>
          <div>
            <small>Pickup Location</small>
            <p id="pickup-display">Loading...</p>
          </div>
        </div>
        <div class="trip-detail-item">
          <i class="fas fa-flag" style="color: #ef4444;"></i>
          <div>
            <small>Drop Location</small>
            <p id="dropoff-display">Loading...</p>
          </div>
        </div>
        <div class="trip-detail-item">
          <i class="fas fa-road"></i>
          <div>
            <small>Distance</small>
            <p id="distance-display">0 km</p>
          </div>
        </div>
        <div class="trip-detail-item">
          <i class="fas fa-rupee-sign"></i>
          <div>
            <small>Fare</small>
            <p id="fare-display">‚Çπ0</p>
          </div>
        </div>
      </div>

      <!-- Payment Options -->
      <div class="payment-section" id="payment-section" style="display: none;">
        <h3><i class="fas fa-wallet"></i> Payment via Wallet</h3>
        
        <!-- Wallet Balance Display -->
        <div class="wallet-balance-display">
          <div class="balance-card">
            <div class="balance-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="balance-info">
              <small>Your Wallet Balance</small>
              <h2 id="user-wallet-balance">‚Çπ2000.00</h2>
            </div>
          </div>
          
          <div class="fare-breakdown">
            <div class="fare-item">
              <span>Ride Fare:</span>
              <span id="payment-fare-display">‚Çπ0</span>
            </div>
            <div class="fare-item remaining">
              <span>Remaining Balance:</span>
              <span id="remaining-balance">‚Çπ2000.00</span>
            </div>
          </div>
        </div>

        <div class="payment-note">
          <i class="fas fa-info-circle"></i>
          <p>Amount will be deducted from your wallet and transferred to driver's wallet upon confirmation.</p>
        </div>

        <button class="btn btn-primary btn-pay" id="confirm-payment-btn" style="display: none;">
          <i class="fas fa-check-circle"></i> Pay ‚Çπ<span id="pay-amount">0</span> from Wallet
        </button>

        <button class="btn btn-outline" id="add-money-btn" style="display: none; margin-top: 10px;">
          <i class="fas fa-plus-circle"></i> Add Money to Wallet
        </button>
      </div>

      <!-- Action Buttons -->
      <div class="ride-actions">
        <button class="btn btn-danger" id="cancel-ride-btn" onclick="cancelCurrentRide()">
          <i class="fas fa-times"></i> Cancel Ride
        </button>
        <button class="btn btn-outline" onclick="refreshRideStatus()">
          <i class="fas fa-sync-alt"></i> Refresh Status
        </button>
      </div>
    </div>

    <!-- Live Map with Driver Location -->
    <div class="status-map-container">
      <h3><i class="fas fa-map-marked-alt"></i> Live Tracking</h3>
      <div id="user-tracking-map" style="height: 450px; border-radius: 12px; overflow: hidden;"></div>
    </div>
  </div>
</div>





 
   <footer id="main-footer" class="footer">
    <div class="footer-container">
     
      <div class="footer-brand">
        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="SwiftRide Logo" class="footer-logo">
        <p>SwiftRide ‚Äì Premium Cab Services for a safer, faster and more comfortable journey.</p>
      </div>

      
      <div class="footer-links">
        <h3>SwiftRide</h3>
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Careers</a></li>
          <li><a href="#">Blog</a></li>
          <li><a href="#">Press</a></li>
        </ul>
      </div>

      <div class="footer-links">
        <h3>Support</h3>
        <ul>
          <li><a href="#">Help Center</a></li>
          <li><a href="#">Safety</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="#">COVID-19 Updates</a></li>
        </ul>
      </div>

     
      <div class="footer-social">
        <h3>Follow Us</h3>
        <div class="social-icons">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-linkedin-in"></i></a>
        </div>
        <h3>Get the App</h3>
        <div class="app-buttons">
          <a href="#"><img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg" alt="Google Play"></a>
          <a href="#"><img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg" alt="App Store"></a>
        </div>
      </div>
    </div>

  
    <div class="footer-bottom">
      <p>¬© 2025 SwiftRide. All rights reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></p>
    </div>
  </footer> 

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet Routing Machine JS -->
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

 

<!-- <script>
console.log('=== DEBUG ===');
console.log('Form exists?', !!document.getElementById('driverStep3'));
console.log('Form element:', document.getElementById('driverStep3'));

// Try to see if handler is attached
const form = document.getElementById('driverStep3');
if (form) {
  form.addEventListener('submit', (e) => {
    console.log('üõë FALLBACK HANDLER - Should not see this!');
    e.preventDefault();
    alert('Form submitted but handler not working!');
  });
}
</script> -->
<!-- Add this script at the VERY END of your index.html, right before </body> -->
<script>








console.log('üîß Loading inline driver signup handler...');

// Wait for everything to load
window.addEventListener('load', function() {
  console.log('‚úÖ Window loaded, attaching driver signup handler...');
  
  const form = document.getElementById('driverStep3');
  
  if (!form) {
    console.error('‚ùå driverStep3 not found!');
    return;
  }
  
  console.log('‚úÖ Found form:', form);
  
  // Remove ALL existing event listeners by cloning the form
  const newForm = form.cloneNode(true);
  form.parentNode.replaceChild(newForm, form);
  const freshForm = document.getElementById('driverStep3');
  
  console.log('üîÑ Form cloned to remove old handlers');
  
  // License preview
  const licenseInput = document.getElementById('license_image');
  const licensePreview = document.getElementById('licensePreview');
  
  if (licenseInput) {
    licenseInput.addEventListener('change', function(e) {
      if (!licensePreview) return;
      licensePreview.innerHTML = '';
      const f = e.target.files[0];
      if (!f) return;
      
      const ext = (f.name.split('.').pop() || '').toLowerCase();
      const allowed = ['jpg','jpeg','png','pdf'];
      
      if (!allowed.includes(ext)) {
        licensePreview.innerHTML = '<div style="color:red;">Invalid file type</div>';
        licenseInput.value = '';
        return;
      }
      
      if (f.size > 5 * 1024 * 1024) {
        licensePreview.innerHTML = '<div style="color:red;">File too large (max 5MB)</div>';
        licenseInput.value = '';
        return;
      }
      
      if (f.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(f);
        img.style.maxWidth = '220px';
        img.style.borderRadius = '6px';
        licensePreview.appendChild(img);
      } else {
        const p = document.createElement('div');
        p.style.color = 'green';
        p.textContent = '‚úì ' + f.name;
        licensePreview.appendChild(p);
      }
    });
  }
  
  // Main submit handler
  freshForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    
    console.log('üöÄ INLINE HANDLER: Form submitted!');
    
    // Get values
    function getVal(id) {
      const el = document.getElementById(id);
      return el ? (el.value || '').trim() : '';
    }
    
    const firstName = getVal('driver_firstName');
    const lastName = getVal('driver_lastName');
    const full_name = (firstName + ' ' + lastName).trim();
    const phone = getVal('driver_phone');
    const email = getVal('driver_email');
    const license_no = getVal('license_no');
    const vehicle_type = getVal('vehicle_type');
    const vehicle_make = getVal('vehicle_make');
    const vehicle_model = getVal('vehicle_model');
    const license_plate = getVal('license_plate');
    const password = getVal('password_driver');
    const confirm = getVal('confirmPassword_driver');
    
    console.log('üìã Data:', {firstName, lastName, phone, email, license_no, vehicle_type});
    
    // Validate
    if (!firstName || !lastName) {
      alert('‚ùå First and last name required');
      if (typeof showStep === 'function') showStep(1);
      return;
    }
    
    if (!phone || !/^\d{10}$/.test(phone)) {
      alert('‚ùå Valid 10-digit phone required');
      if (typeof showStep === 'function') showStep(1);
      return;
    }
    
    if (!email) {
      alert('‚ùå Email required');
      if (typeof showStep === 'function') showStep(1);
      return;
    }
    
    if (!license_no || !vehicle_type) {
      alert('‚ùå License and vehicle type required');
      if (typeof showStep === 'function') showStep(2);
      return;
    }
    
    const licenseFile = licenseInput?.files?.[0];
    if (!licenseFile) {
      alert('‚ùå License image required');
      if (typeof showStep === 'function') showStep(2);
      return;
    }
    
    if (!password || password.length < 8) {
      alert('‚ùå Password must be 8+ characters');
      return;
    }
    
    if (password !== confirm) {
      alert('‚ùå Passwords do not match');
      return;
    }
    
    // Build FormData
    const fd = new FormData();
    fd.append('full_name', full_name);
    fd.append('firstName', firstName);
    fd.append('lastName', lastName);
    fd.append('phone', phone);
    fd.append('email', email);
    fd.append('license_no', license_no);
    fd.append('vehicle_type', vehicle_type);
    fd.append('vehicle_make', vehicle_make);
    fd.append('vehicle_model', vehicle_model);
    fd.append('license_plate', license_plate);
    fd.append('password', password);
    fd.append('license_image', licenseFile, licenseFile.name);
    
    console.log('üì§ Sending to /driver/signup...');
    
    const submitBtn = freshForm.querySelector('button[type="submit"]');
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating...';
    }
    
    try {
      const res = await fetch('/driver/signup', {
        method: 'POST',
        credentials: 'include',
        body: fd
      });
      
      console.log('üì• Status:', res.status);
      const data = await res.json().catch(() => ({}));
      console.log('üì• Data:', data);
      
      if (res.status === 201) {
        alert('‚úÖ Account created! Redirecting to login...');
        setTimeout(() => {
          if (typeof showPage === 'function') {
            showPage('driver-login');
          } else {
            window.location.href = '/driver/login';
          }
        }, 1000);
        return;
      }
      
      if (res.status === 409) {
        alert('‚ùå ' + (data.error || 'Phone/email already registered'));
        return;
      }
      
      alert('‚ùå ' + (data.error || 'Signup failed'));
      
    } catch (err) {
      console.error('‚ùå Error:', err);
      alert('‚ùå Network error');
    } finally {
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Driver Account';
      }
    }
  }, true); // Use capture phase
  
  console.log('‚úÖ INLINE handler attached!');
});







// (function(){
//   // attach in load to ensure DOM + other scripts settled
//   window.addEventListener('load', () => {
//     const form = document.getElementById('driver-login-form');
//     if (!form) {
//       console.error('DRIVER-LOGIN: form not found (id=driver-login-form)');
//       return;
//     }
//     // remove previously attached test handlers if any (best-effort)
//     try { form.removeEventListener('submit', form._robustHandler, true); } catch(e){}

//     async function robustHandler(e){
//       // capture-phase: run first, prevent others
//       e.preventDefault();
//       e.stopImmediatePropagation();
//       e.stopPropagation();

//       console.log('DRIVER-LOGIN: submit captured (robust handler)');

//       const getVal = id => (document.getElementById(id) || {}).value || '';

//       const phone = getVal('driver-login-phone').trim();
//       const email = getVal('driver-login-email').trim();
//       const password = getVal('driver-login-password');

//       console.log('DRIVER-LOGIN: collected', {phone, email, passwordLen: password.length});

//       if (!password || (!phone && !email)) {
//         alert('Enter phone or email and password');
//         return;
//       }

//       const payload = phone ? {phone, password} : {email, password};

//       try {
//         const res = await fetch('/driver/login', {
//           method: 'POST',
//           headers: {'Content-Type': 'application/json'},
//           credentials: 'include',
//           body: JSON.stringify(payload),
//           redirect: 'follow' // allow following redirects
//         });

//         console.log('DRIVER-LOGIN: fetch finished status=', res.status, 'ok=', res.ok, 'redirected=', res.redirected);

//         // Try parse JSON safely
//         let body;
//         try {
//           body = await res.json();
//           console.log('DRIVER-LOGIN: parsed JSON:', body);
//         } catch (je) {
//           body = await res.text();
//           console.log('DRIVER-LOGIN: received non-JSON body (first 800 chars):', (body||'').slice(0,800));
//         }

//         if (res.ok) {
//           // prefer explicit redirect from server JSON
//           if (body && typeof body === 'object' && body.redirect) {
//             window.location.href = body.redirect;
//             return;
//           }
//           // otherwise go to dashboard (safe fallback)
//           window.location.href = '/driver/dashboard';
//           return;
//         }

//         // non-ok: show message if present in JSON or text
//         if (body && typeof body === 'object' && body.error) {
//           alert(body.error);
//         } else if (typeof body === 'string' && body.trim()) {
//           alert('Server: ' + body.slice(0,200));
//         } else {
//           alert('Login failed: status ' + res.status);
//         }

//       } catch(err) {
//         console.error('DRIVER-LOGIN: network/fetch error', err);
//         alert('Network error ‚Äî check server is running and CORS/session config.');
//       }
//     }

//     // attach as capture-phase to run before bubble handlers and to override
//     form.addEventListener('submit', robustHandler, true);
//     form._robustHandler = robustHandler;
//     console.log('DRIVER-LOGIN: robust handler attached (capture). Submit the form now.');
//   });
// })();
console.log('üîß Loading driver login handler...');

window.addEventListener('load', function() {
  const form = document.getElementById('driver-login-form');
  
  if (!form) {
    console.warn('‚ùå driver-login-form not found');
    return;
  }
  
  console.log('‚úÖ Found driver login form');
  

  const newForm = form.cloneNode(true);
  form.parentNode.replaceChild(newForm, form);
  const freshForm = document.getElementById('driver-login-form');
  
  freshForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    e.stopPropagation();
    
    console.log('üîê Driver login form submitted');
    
    const emailInput = document.getElementById('driver-login-email');
    const phoneInput = document.getElementById('driver-login-phone');
    const passwordInput = document.getElementById('driver-login-password');
    
    const email = emailInput ? emailInput.value.trim() : '';
    const phone = phoneInput ? phoneInput.value.trim() : '';
    const password = passwordInput ? passwordInput.value : '';
    
    console.log('üìã Login data:', { email: email || '(empty)', phone: phone || '(empty)', password: password ? '***' : '(empty)' });
    
    if (!password) {
      alert('‚ùå Please enter your password');
      return;
    }
    
    if (!email && !phone) {
      alert('‚ùå Please enter your email or phone number');
      return;
    }
    
   
    const payload = email ? { email, password } : { phone, password };
    
    console.log('üì§ Sending to /driver/login...');
    
    const submitBtn = freshForm.querySelector('button[type="submit"]');
    if (submitBtn) {
      submitBtn.disabled = true;
      submitBtn.textContent = 'Signing in...';
    }
    
    try {
      const res = await fetch('/driver/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify(payload)
      });
      
      console.log('üì• Response status:', res.status);
      
      const data = await res.json().catch(() => ({}));
      console.log('üì• Response data:', data);
      
      if (res.ok) {
        console.log('‚úÖ Login successful!');
        alert('‚úÖ Login successful! Redirecting to dashboard...');
        
      
        setTimeout(() => {
          window.location.href = data.redirect || '/driver/dashboard';
        }, 500);
        return;
      }
      
      if (res.status === 401) {
        alert('‚ùå Invalid email/phone or password');
        return;
      }
      
      alert('‚ùå ' + (data.error || 'Login failed'));
      
    } catch (err) {
      console.error('‚ùå Network error:', err);
      alert('‚ùå Network error. Make sure Flask is running.');
    } finally {
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Sign In as Driver';
      }
    }
  });
  
  console.log('‚úÖ Driver login handler attached');
});















// Add this to your JavaScript - Auto-update wallet balance in navbar
async function updateNavbarWalletBalance() {
  const walletDisplay = document.getElementById('navbar-wallet-balance');
  if (!walletDisplay) return;

  try {
    const response = await fetch('/user/wallet_balance', {
      credentials: 'include'
    });

    if (response.ok) {
      const data = await response.json();
      walletDisplay.textContent = `‚Çπ${data.wallet_balance.toFixed(2)}`;
    }
  } catch (error) {
    console.error('Error updating wallet balance:', error);
  }
}

// Show wallet details modal
function showWalletDetails() {
  alert('Wallet details feature coming soon! You can view your balance in the navbar.');
  // TODO: Create a proper wallet details modal/page
}

// Update wallet balance when page loads
document.addEventListener('DOMContentLoaded', function() {
  updateNavbarWalletBalance();
  
  // Refresh wallet balance every 30 seconds
  setInterval(updateNavbarWalletBalance, 30000);
});

// Update wallet balance after payment
window.addEventListener('paymentCompleted', function() {
  updateNavbarWalletBalance();
});
</script>


  
</body>

</html>